<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Galaxy - Learn Git by Playing!</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: #fff;
            overflow: hidden;
        }

        .navbar {
            padding: 10px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }
        .back-home {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 700;
        }
        .back-home:hover { color: #fff; }

        .game-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 15px;
        }

        .game-header h1 {
            font-size: 1.6rem;
            font-weight: 900;
            text-align: center;
            background: linear-gradient(90deg, #00d9ff, #a855f7, #00d9ff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 3s linear infinite;
        }
        @keyframes shimmer { to { background-position: 200% center; } }

        .game-area {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            margin-top: 8px;
        }

        #gameCanvas {
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.4);
            border: 2px solid rgba(138, 43, 226, 0.5);
        }

        /* Terminal */
        .terminal {
            width: 240px;
            background: #1a1a2e;
            border-radius: 10px;
            border: 2px solid #333;
            font-family: 'Fira Code', monospace;
        }
        .terminal-header {
            background: #2d2d44;
            padding: 5px 8px;
            display: flex;
            gap: 4px;
            align-items: center;
        }
        .terminal-dot { width: 8px; height: 8px; border-radius: 50%; }
        .terminal-dot.red { background: #ff5f56; }
        .terminal-dot.yellow { background: #ffbd2e; }
        .terminal-dot.green { background: #27ca40; }
        .terminal-body {
            padding: 8px;
            height: 360px;
            overflow-y: auto;
            font-size: 0.6rem;
            line-height: 1.4;
        }
        .cmd { color: #00d9ff; }
        .success { color: #27ca40; }
        .error { color: #ff5f56; }
        .commit { color: #a855f7; }
        .dim { opacity: 0.5; }

        /* Quiz Modal */
        .quiz-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.92);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }
        .quiz-modal.active { display: flex; }
        .quiz-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #2d2d44 100%);
            border-radius: 16px;
            padding: 25px 35px;
            text-align: center;
            max-width: 480px;
            border: 3px solid #00d9ff;
        }
        .quiz-content.wrong { border-color: #ff5f56; animation: shake 0.3s; }
        .quiz-content.correct { border-color: #27ca40; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        .quiz-icon { font-size: 2.5rem; margin-bottom: 10px; }
        .quiz-title {
            font-size: 1.3rem;
            font-weight: 900;
            margin-bottom: 8px;
        }
        .quiz-question {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        .quiz-options {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .quiz-option {
            background: #2a2a4a;
            border: 2px solid #444;
            border-radius: 10px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Fira Code', monospace;
            font-size: 0.95rem;
            color: #fff;
            min-width: 120px;
        }
        .quiz-option:hover {
            border-color: #00d9ff;
            transform: translateY(-2px);
        }
        .quiz-option.correct-choice {
            border-color: #27ca40;
            background: #1a3a1a;
        }
        .quiz-option.wrong-choice {
            border-color: #ff5f56;
            background: #3a1a1a;
        }
        .quiz-feedback {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
        }
        .quiz-feedback.show { display: block; }
        .quiz-feedback.wrong {
            background: rgba(255, 95, 86, 0.2);
            border: 1px solid #ff5f56;
            color: #ff5f56;
        }
        .quiz-feedback.correct {
            background: rgba(39, 202, 64, 0.2);
            border: 1px solid #27ca40;
            color: #27ca40;
        }

        /* Death Modal - now with 2 choices */
        .death-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.92);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }
        .death-modal.active { display: flex; }
        .death-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #2d2d44 100%);
            border-radius: 16px;
            border: 3px solid #ff5f56;
            padding: 25px 35px;
            text-align: center;
            max-width: 520px;
        }
        .death-content h2 { color: #ff5f56; font-size: 1.8rem; margin-bottom: 8px; }
        .death-content > p { opacity: 0.8; margin-bottom: 20px; font-size: 0.95rem; }
        .death-choices { display: flex; gap: 15px; justify-content: center; }
        .death-choice {
            background: #2a2a4a;
            border: 2px solid #444;
            border-radius: 10px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s;
            width: 200px;
            text-align: center;
        }
        .death-choice:hover { transform: translateY(-2px); }
        .death-choice.checkout { border-color: #a855f7; }
        .death-choice.checkout:hover { background: #3a2a5a; }
        .death-choice.reset { border-color: #ff5f56; }
        .death-choice.reset:hover { background: #4a2a3a; }
        .death-choice .cmd-name {
            font-family: 'Fira Code', monospace;
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 6px;
        }
        .death-choice.checkout .cmd-name { color: #a855f7; }
        .death-choice.reset .cmd-name { color: #ff5f56; }
        .death-choice .cmd-desc { font-size: 0.8rem; opacity: 0.8; }

        /* Stats */
        .stats-bar {
            display: flex;
            gap: 12px;
            margin-top: 8px;
            font-size: 0.8rem;
        }
        .stat {
            background: rgba(255,255,255,0.1);
            padding: 5px 12px;
            border-radius: 12px;
        }
        .stat-label { opacity: 0.7; }
        .stat-value { font-weight: 700; color: #00d9ff; }

        .controls-hint { margin-top: 6px; opacity: 0.4; font-size: 0.7rem; }

        /* Start screen */
        .start-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 400;
            text-align: center;
            padding: 20px;
        }
        .start-screen.hidden { display: none; }
        .start-screen h1 {
            font-size: 3rem;
            margin-bottom: 8px;
            background: linear-gradient(90deg, #00d9ff, #a855f7, #00d9ff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 3s linear infinite;
        }
        .start-screen .subtitle { font-size: 1.1rem; opacity: 0.9; margin-bottom: 20px; }
        .start-screen .how-it-works {
            max-width: 500px;
            text-align: left;
            background: rgba(255,255,255,0.05);
            padding: 18px 22px;
            border-radius: 14px;
            margin-bottom: 20px;
        }
        .start-screen .how-it-works h3 { margin-bottom: 10px; color: #00d9ff; font-size: 1rem; }
        .start-screen .how-it-works p { margin-bottom: 6px; font-size: 0.85rem; opacity: 0.9; }
        .btn {
            background: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);
            border: none;
            padding: 12px 36px;
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            border-radius: 50px;
            cursor: pointer;
            font-family: inherit;
        }
        .btn:hover { transform: translateY(-2px); }

        /* Level complete */
        .level-complete {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.92);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 300;
        }
        .level-complete.active { display: flex; }
        .level-complete h2 { font-size: 2.2rem; color: #27ca40; margin-bottom: 12px; }
        .level-complete .push-cmd {
            font-family: 'Fira Code', monospace;
            color: #00d9ff;
            margin-bottom: 18px;
            font-size: 0.95rem;
        }

        /* Stars */
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star { position: absolute; background: #fff; border-radius: 50%; animation: twinkle 2s infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        @media (max-width: 900px) {
            .game-area { flex-direction: column; }
            .terminal { width: 100%; max-width: 700px; }
            .terminal-body { height: 100px; }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>

    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
        <h1>Git Galaxy</h1>
        <p class="subtitle">Learn Git by choosing the right commands!</p>

        <div class="how-it-works">
            <h3>How It Works</h3>
            <p>üì¶ <strong>Collect a file</strong> ‚Üí Choose the right command to stage it</p>
            <p>üö© <strong>Reach checkpoint</strong> ‚Üí Choose the right command to save</p>
            <p>üíÄ <strong>Die?</strong> ‚Üí Choose: go back to checkpoint or restart level</p>
            <p>‚≠ê <strong>Reach the goal</strong> ‚Üí Choose the right command to complete!</p>
            <p style="margin-top:10px;opacity:0.7;font-size:0.8rem;">Get it wrong? No problem - learn from it and try again!</p>
        </div>

        <button class="btn" id="startBtn">START LEARNING</button>
        <p style="margin-top: 10px; font-size: 0.75rem; opacity: 0.4;">Arrow keys to move ‚Ä¢ Space to jump</p>
    </div>

    <!-- Quiz Modal -->
    <div class="quiz-modal" id="quizModal">
        <div class="quiz-content" id="quizContent">
            <div class="quiz-icon" id="quizIcon">üì¶</div>
            <div class="quiz-title" id="quizTitle">You collected a file!</div>
            <div class="quiz-question" id="quizQuestion">What command stages a file for commit?</div>
            <div class="quiz-options" id="quizOptions">
                <!-- Options inserted by JS -->
            </div>
            <div class="quiz-feedback" id="quizFeedback"></div>
        </div>
    </div>

    <!-- Death Modal -->
    <div class="death-modal" id="deathModal">
        <div class="death-content">
            <h2>YOU DIED!</h2>
            <p>Choose how to recover:</p>
            <div class="death-choices">
                <div class="death-choice checkout" id="choiceCheckout">
                    <div class="cmd-name">git checkout</div>
                    <div class="cmd-desc" id="checkoutDesc">Go back to last checkpoint</div>
                </div>
                <div class="death-choice reset" id="choiceReset">
                    <div class="cmd-name">git reset --hard</div>
                    <div class="cmd-desc">Restart the entire level</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Level Complete -->
    <div class="level-complete" id="levelComplete">
        <h2>LEVEL COMPLETE!</h2>
        <div class="push-cmd">$ git push origin main<br><span style="color:#27ca40">‚úì Pushed successfully!</span></div>
        <button class="btn" id="nextLevelBtn">NEXT LEVEL</button>
    </div>

    <nav class="navbar">
        <a href="../../index.html" class="back-home">‚Üê Back</a>
        <span style="font-size:0.8rem;opacity:0.6;">Git Galaxy</span>
    </nav>

    <div class="game-wrapper">
        <div class="game-header">
            <h1>Git Galaxy</h1>
        </div>

        <div class="game-area">
            <canvas id="gameCanvas" width="720" height="400"></canvas>
            <div class="terminal">
                <div class="terminal-header">
                    <div class="terminal-dot red"></div>
                    <div class="terminal-dot yellow"></div>
                    <div class="terminal-dot green"></div>
                </div>
                <div class="terminal-body" id="terminalBody">
                    <div class="dim">$ git init</div>
                    <div class="success">Ready!</div>
                </div>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat"><span class="stat-label">Level:</span> <span class="stat-value" id="levelNum">1</span>/5</div>
            <div class="stat"><span class="stat-label">Staged:</span> <span class="stat-value" id="stagedCount">0</span></div>
            <div class="stat"><span class="stat-label">Commits:</span> <span class="stat-value" id="commitCount">0</span></div>
            <div class="stat"><span class="stat-label">Score:</span> <span class="stat-value" id="scoreCount">0</span></div>
        </div>

        <div class="controls-hint">Arrow keys / WASD ‚Ä¢ Space to jump</div>
    </div>

    <script>
        // Stars
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 60; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.width = star.style.height = (Math.random() * 2 + 1) + 'px';
            star.style.animationDelay = Math.random() * 2 + 's';
            starsContainer.appendChild(star);
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Camera
        let cameraX = 0;
        const CAMERA_LERP = 0.08;

        // Game state
        let currentLevel = 1;
        let gameRunning = false;
        let stagedFiles = [];
        let commitCount = 0;
        let score = 0;
        let lastCheckpoint = null;
        let hasCheckpoint = false;

        // Quiz state
        let currentQuiz = null;
        let pendingFile = null;
        let pendingCheckpoint = null;

        // File types
        const fileTypes = [
            { name: 'app.js', color: '#f1c40f' },
            { name: 'index.html', color: '#e74c3c' },
            { name: 'style.css', color: '#3498db' },
            { name: 'data.json', color: '#1abc9c' },
            { name: 'utils.js', color: '#9b59b6' },
            { name: 'config.js', color: '#e67e22' },
        ];

        // Quiz definitions
        const quizzes = {
            add: {
                icon: 'üì¶',
                title: 'File collected!',
                question: 'What command STAGES a file for commit?',
                options: ['git add', 'git commit', 'git push'],
                correct: 0,
                explanations: [
                    '‚úì Correct! "git add" stages files for the next commit.',
                    '‚úó "git commit" SAVES staged changes, but you need to stage first with "git add"!',
                    '‚úó "git push" sends commits to GitHub, but you haven\'t staged or committed yet!'
                ]
            },
            commit: {
                icon: 'üö©',
                title: 'Checkpoint reached!',
                question: 'What command SAVES your staged changes?',
                options: ['git commit', 'git add', 'git push'],
                correct: 0,
                explanations: [
                    '‚úì Correct! "git commit" saves your staged changes with a message.',
                    '‚úó "git add" stages files, but they\'re already staged! You need to SAVE them now.',
                    '‚úó "git push" sends to GitHub, but you need to commit first!'
                ]
            },
            push: {
                icon: '‚≠ê',
                title: 'Goal reached!',
                question: 'What command sends your commits to GitHub?',
                options: ['git push', 'git commit', 'git add'],
                correct: 0,
                explanations: [
                    '‚úì Correct! "git push" sends your commits to the remote repository!',
                    '‚úó "git commit" saves locally. Use "git push" to send to GitHub!',
                    '‚úó "git add" just stages files. You need "git push" to share your work!'
                ]
            }
        };

        // Player
        const player = {
            x: 50, y: 300,
            width: 26, height: 26,
            velX: 0, velY: 0,
            speed: 4.5, jumpPower: 12,
            onGround: false, facingRight: true
        };

        const gravity = 0.48;
        const friction = 0.85;

        // Levels
        const levels = [
            {
                width: 1800,
                platforms: [
                    { x: 0, y: 370, width: 280, height: 30 },
                    { x: 340, y: 330, width: 100, height: 12 },
                    { x: 500, y: 290, width: 100, height: 12 },
                    { x: 660, y: 370, width: 180, height: 30 },
                    { x: 900, y: 320, width: 100, height: 12 },
                    { x: 1060, y: 270, width: 100, height: 12 },
                    { x: 1220, y: 370, width: 180, height: 30 },
                    { x: 1460, y: 310, width: 140, height: 12 },
                ],
                files: [
                    { x: 150, y: 330, ...fileTypes[0] },
                    { x: 370, y: 290, ...fileTypes[1] },
                    { x: 530, y: 250, ...fileTypes[2] },
                    { x: 720, y: 330, ...fileTypes[3] },
                    { x: 930, y: 280, ...fileTypes[4] },
                    { x: 1090, y: 230, ...fileTypes[5] },
                    { x: 1490, y: 270, ...fileTypes[0] },
                ],
                checkpoints: [
                    { x: 700, y: 338 },
                    { x: 1260, y: 338 },
                ],
                goal: { x: 1550, y: 268 },
                spikes: [],
                pits: [],
                bg: ['#1a0a2e', '#2d1b4e']
            },
            {
                width: 2000,
                platforms: [
                    { x: 0, y: 370, width: 200, height: 30 },
                    { x: 280, y: 320, width: 80, height: 12 },
                    { x: 440, y: 270, width: 80, height: 12 },
                    { x: 600, y: 370, width: 160, height: 30 },
                    { x: 840, y: 320, width: 80, height: 12 },
                    { x: 1000, y: 270, width: 80, height: 12 },
                    { x: 1160, y: 220, width: 80, height: 12 },
                    { x: 1320, y: 370, width: 160, height: 30 },
                    { x: 1560, y: 310, width: 120, height: 12 },
                    { x: 1740, y: 370, width: 160, height: 30 },
                ],
                files: [
                    { x: 100, y: 330, ...fileTypes[1] },
                    { x: 300, y: 280, ...fileTypes[2] },
                    { x: 460, y: 230, ...fileTypes[3] },
                    { x: 660, y: 330, ...fileTypes[4] },
                    { x: 860, y: 280, ...fileTypes[5] },
                    { x: 1020, y: 230, ...fileTypes[0] },
                    { x: 1180, y: 180, ...fileTypes[1] },
                    { x: 1380, y: 330, ...fileTypes[2] },
                    { x: 1590, y: 270, ...fileTypes[3] },
                ],
                checkpoints: [
                    { x: 640, y: 338 },
                    { x: 1360, y: 338 },
                ],
                goal: { x: 1800, y: 328 },
                spikes: [
                    { x: 200, y: 350, width: 80, height: 20 },
                    { x: 760, y: 350, width: 80, height: 20 },
                    { x: 1480, y: 350, width: 80, height: 20 },
                ],
                pits: [],
                bg: ['#0a1628', '#1a3a5c']
            },
            {
                width: 2200,
                platforms: [
                    { x: 0, y: 370, width: 160, height: 30 },
                    { x: 240, y: 320, width: 80, height: 12 },
                    { x: 400, y: 270, width: 80, height: 12 },
                    { x: 560, y: 370, width: 140, height: 30 },
                    { x: 780, y: 320, width: 80, height: 12 },
                    { x: 940, y: 270, width: 80, height: 12 },
                    { x: 1100, y: 370, width: 140, height: 30 },
                    { x: 1320, y: 310, width: 80, height: 12 },
                    { x: 1480, y: 260, width: 80, height: 12 },
                    { x: 1640, y: 210, width: 80, height: 12 },
                    { x: 1800, y: 370, width: 200, height: 30 },
                ],
                files: [
                    { x: 80, y: 330, ...fileTypes[0] },
                    { x: 260, y: 280, ...fileTypes[1] },
                    { x: 420, y: 230, ...fileTypes[2] },
                    { x: 600, y: 330, ...fileTypes[3] },
                    { x: 800, y: 280, ...fileTypes[4] },
                    { x: 960, y: 230, ...fileTypes[5] },
                    { x: 1140, y: 330, ...fileTypes[0] },
                    { x: 1340, y: 270, ...fileTypes[1] },
                    { x: 1500, y: 220, ...fileTypes[2] },
                    { x: 1660, y: 170, ...fileTypes[3] },
                ],
                checkpoints: [
                    { x: 590, y: 338 },
                    { x: 1130, y: 338 },
                    { x: 1830, y: 338 },
                ],
                goal: { x: 1900, y: 328 },
                spikes: [
                    { x: 160, y: 350, width: 80, height: 20 },
                    { x: 700, y: 350, width: 80, height: 20 },
                    { x: 1240, y: 350, width: 80, height: 20 },
                ],
                pits: [
                    { x: 480, y: 400, width: 80 },
                    { x: 1020, y: 400, width: 80 },
                    { x: 1720, y: 400, width: 80 },
                ],
                bg: ['#1a0a0a', '#3d1a1a']
            },
            {
                width: 2400,
                platforms: [
                    { x: 0, y: 370, width: 120, height: 30 },
                    { x: 180, y: 320, width: 60, height: 12 },
                    { x: 300, y: 270, width: 60, height: 12 },
                    { x: 420, y: 220, width: 60, height: 12 },
                    { x: 540, y: 370, width: 120, height: 30 },
                    { x: 720, y: 310, width: 60, height: 12 },
                    { x: 840, y: 260, width: 60, height: 12 },
                    { x: 960, y: 370, width: 120, height: 30 },
                    { x: 1140, y: 320, width: 60, height: 12 },
                    { x: 1260, y: 270, width: 60, height: 12 },
                    { x: 1380, y: 220, width: 60, height: 12 },
                    { x: 1500, y: 370, width: 120, height: 30 },
                    { x: 1680, y: 310, width: 80, height: 12 },
                    { x: 1820, y: 260, width: 80, height: 12 },
                    { x: 1960, y: 210, width: 80, height: 12 },
                    { x: 2100, y: 370, width: 180, height: 30 },
                ],
                files: [
                    { x: 50, y: 330, ...fileTypes[0] },
                    { x: 195, y: 280, ...fileTypes[1] },
                    { x: 315, y: 230, ...fileTypes[2] },
                    { x: 435, y: 180, ...fileTypes[3] },
                    { x: 580, y: 330, ...fileTypes[4] },
                    { x: 735, y: 270, ...fileTypes[5] },
                    { x: 855, y: 220, ...fileTypes[0] },
                    { x: 1000, y: 330, ...fileTypes[1] },
                    { x: 1155, y: 280, ...fileTypes[2] },
                    { x: 1275, y: 230, ...fileTypes[3] },
                    { x: 1395, y: 180, ...fileTypes[4] },
                    { x: 1540, y: 330, ...fileTypes[5] },
                    { x: 1700, y: 270, ...fileTypes[0] },
                    { x: 1840, y: 220, ...fileTypes[1] },
                    { x: 1980, y: 170, ...fileTypes[2] },
                ],
                checkpoints: [
                    { x: 570, y: 338 },
                    { x: 990, y: 338 },
                    { x: 1530, y: 338 },
                    { x: 2130, y: 338 },
                ],
                goal: { x: 2200, y: 328 },
                spikes: [
                    { x: 120, y: 350, width: 60, height: 20 },
                    { x: 480, y: 200, width: 60, height: 20 },
                    { x: 660, y: 350, width: 60, height: 20 },
                    { x: 1080, y: 350, width: 60, height: 20 },
                    { x: 1440, y: 200, width: 60, height: 20 },
                    { x: 1620, y: 350, width: 60, height: 20 },
                    { x: 2040, y: 190, width: 60, height: 20 },
                ],
                pits: [
                    { x: 240, y: 400, width: 60 },
                    { x: 900, y: 400, width: 60 },
                    { x: 1200, y: 400, width: 60 },
                    { x: 1760, y: 400, width: 60 },
                ],
                bg: ['#0a1a0a', '#1a3d1a']
            },
            {
                width: 1600,
                platforms: [
                    { x: 0, y: 370, width: 400, height: 30 },
                    { x: 480, y: 320, width: 120, height: 12 },
                    { x: 680, y: 270, width: 120, height: 12 },
                    { x: 880, y: 220, width: 120, height: 12 },
                    { x: 1080, y: 170, width: 120, height: 12 },
                    { x: 1280, y: 370, width: 220, height: 30 },
                ],
                files: [
                    { x: 100, y: 330, ...fileTypes[0] },
                    { x: 200, y: 330, ...fileTypes[1] },
                    { x: 300, y: 330, ...fileTypes[2] },
                    { x: 510, y: 280, ...fileTypes[3] },
                    { x: 710, y: 230, ...fileTypes[4] },
                    { x: 910, y: 180, ...fileTypes[5] },
                    { x: 1110, y: 130, ...fileTypes[0] },
                    { x: 1350, y: 330, ...fileTypes[1] },
                    { x: 1420, y: 330, ...fileTypes[2] },
                ],
                checkpoints: [
                    { x: 250, y: 338 },
                    { x: 1320, y: 338 },
                ],
                goal: { x: 1400, y: 328 },
                spikes: [],
                pits: [],
                bg: ['#1a0a2e', '#4a1a6e']
            }
        ];

        let currentLevelData = levels[0];
        let collectedFiles = [];
        let activeCheckpoints = [];

        function terminalLog(html) {
            const terminal = document.getElementById('terminalBody');
            const line = document.createElement('div');
            line.innerHTML = html;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function updateStats() {
            document.getElementById('stagedCount').textContent = stagedFiles.length;
            document.getElementById('commitCount').textContent = commitCount;
            document.getElementById('scoreCount').textContent = score;
        }

        // Show quiz
        function showQuiz(type, onCorrect) {
            const quiz = quizzes[type];
            currentQuiz = { type, quiz, onCorrect };

            document.getElementById('quizIcon').textContent = quiz.icon;
            document.getElementById('quizTitle').textContent = quiz.title;
            document.getElementById('quizQuestion').textContent = quiz.question;

            const optionsDiv = document.getElementById('quizOptions');
            optionsDiv.innerHTML = '';

            // Shuffle options for variety (but track correct index)
            const indices = [0, 1, 2];
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }

            indices.forEach(origIdx => {
                const btn = document.createElement('button');
                btn.className = 'quiz-option';
                btn.textContent = quiz.options[origIdx];
                btn.onclick = () => handleQuizAnswer(origIdx, btn);
                optionsDiv.appendChild(btn);
            });

            document.getElementById('quizFeedback').className = 'quiz-feedback';
            document.getElementById('quizFeedback').textContent = '';
            document.getElementById('quizContent').className = 'quiz-content';
            document.getElementById('quizModal').classList.add('active');
        }

        function handleQuizAnswer(chosenIdx, btn) {
            const { quiz, onCorrect } = currentQuiz;
            const feedback = document.getElementById('quizFeedback');
            const content = document.getElementById('quizContent');

            // Disable all buttons
            document.querySelectorAll('.quiz-option').forEach(b => b.style.pointerEvents = 'none');

            if (chosenIdx === quiz.correct) {
                // Correct!
                btn.classList.add('correct-choice');
                content.classList.add('correct');
                feedback.className = 'quiz-feedback show correct';
                feedback.textContent = quiz.explanations[chosenIdx];
                score += 10;
                updateStats();

                setTimeout(() => {
                    document.getElementById('quizModal').classList.remove('active');
                    onCorrect();
                    gameRunning = true;
                }, 1200);
            } else {
                // Wrong!
                btn.classList.add('wrong-choice');
                content.classList.add('wrong');
                feedback.className = 'quiz-feedback show wrong';
                feedback.textContent = quiz.explanations[chosenIdx];

                setTimeout(() => {
                    // Reset for retry
                    btn.classList.remove('wrong-choice');
                    content.classList.remove('wrong');
                    feedback.className = 'quiz-feedback';
                    document.querySelectorAll('.quiz-option').forEach(b => b.style.pointerEvents = 'auto');
                }, 1500);
            }
        }

        // Keys
        const keys = {};
        document.addEventListener('keydown', e => {
            keys[e.code] = true;
            if (['Space', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.code)) {
                e.preventDefault();
            }
        });
        document.addEventListener('keyup', e => { keys[e.code] = false; });

        // Start
        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('startScreen').classList.add('hidden');
            gameRunning = true;
            terminalLog('<span class="dim">---</span>');
            terminalLog('<span class="cmd">$ cd level-1</span>');
            terminalLog('<span class="success">Go!</span>');
            gameLoop();
        });

        // Death choices
        document.getElementById('choiceCheckout').addEventListener('click', () => {
            document.getElementById('deathModal').classList.remove('active');
            terminalLog('<span class="cmd">$ git checkout HEAD</span>');

            if (lastCheckpoint) {
                player.x = lastCheckpoint.x;
                player.y = lastCheckpoint.y - player.height - 10;
            } else {
                player.x = 50;
                player.y = 300;
            }
            player.velX = 0;
            player.velY = 0;
            stagedFiles = [];
            updateStats();
            gameRunning = true;
        });

        document.getElementById('choiceReset').addEventListener('click', () => {
            document.getElementById('deathModal').classList.remove('active');
            terminalLog('<span class="cmd">$ git reset --hard</span>');
            terminalLog('<span class="error">Level reset!</span>');
            loadLevel(currentLevel);
            gameRunning = true;
        });

        // Next level
        document.getElementById('nextLevelBtn').addEventListener('click', () => {
            document.getElementById('levelComplete').classList.remove('active');
            if (currentLevel < levels.length) {
                loadLevel(currentLevel + 1);
            } else {
                alert('üéâ You mastered Git Galaxy!\n\nYou now know:\n‚Ä¢ git add (stage files)\n‚Ä¢ git commit (save changes)\n‚Ä¢ git push (share with GitHub)\n‚Ä¢ git checkout (undo to checkpoint)\n‚Ä¢ git reset (start over)');
                loadLevel(1);
                score = 0;
                commitCount = 0;
            }
            gameRunning = true;
        });

        function loadLevel(num) {
            currentLevel = num;
            currentLevelData = levels[num - 1];
            document.getElementById('levelNum').textContent = num;

            collectedFiles = [];
            stagedFiles = [];
            activeCheckpoints = [];
            lastCheckpoint = null;
            hasCheckpoint = false;
            updateStats();

            player.x = 50;
            player.y = 300;
            player.velX = 0;
            player.velY = 0;
            cameraX = 0;

            terminalLog('<span class="dim">---</span>');
            terminalLog(`<span class="cmd">$ cd level-${num}</span>`);
        }

        function collectFile(file) {
            gameRunning = false;
            pendingFile = file;

            showQuiz('add', () => {
                collectedFiles.push(file);
                stagedFiles.push(file.name);
                updateStats();
                terminalLog(`<span class="cmd">$ git add ${file.name}</span>`);
                terminalLog(`<span class="success">‚úì Staged</span>`);
            });
        }

        function hitCheckpoint(checkpoint) {
            if (activeCheckpoints.includes(checkpoint)) return;

            gameRunning = false;
            showQuiz('commit', () => {
                activeCheckpoints.push(checkpoint);
                lastCheckpoint = checkpoint;
                hasCheckpoint = true;
                commitCount++;

                const msg = `Checkpoint ${activeCheckpoints.length}`;
                terminalLog('<span class="dim">---</span>');
                terminalLog(`<span class="cmd">$ git commit -m "${msg}"</span>`);
                terminalLog(`<span class="commit">[main ${Math.random().toString(36).substr(2,5)}]</span> ${stagedFiles.length} files`);

                stagedFiles = [];
                updateStats();
            });
        }

        function reachGoal() {
            gameRunning = false;
            showQuiz('push', () => {
                terminalLog('<span class="dim">---</span>');
                terminalLog('<span class="cmd">$ git push origin main</span>');
                terminalLog('<span class="success">‚úì Level complete!</span>');

                setTimeout(() => {
                    document.getElementById('levelComplete').classList.add('active');
                    if (currentLevel >= levels.length) {
                        document.getElementById('nextLevelBtn').textContent = 'PLAY AGAIN';
                    }
                }, 400);
            });
        }

        function playerDied() {
            gameRunning = false;

            const desc = document.getElementById('checkoutDesc');
            if (!hasCheckpoint) {
                desc.textContent = 'No checkpoint yet (same as reset)';
            } else {
                desc.textContent = 'Go back to last checkpoint';
            }

            document.getElementById('deathModal').classList.add('active');
        }

        function checkCollision(a, b) {
            return a.x < b.x + b.width && a.x + a.width > b.x &&
                   a.y < b.y + b.height && a.y + a.height > b.y;
        }

        function update() {
            // Movement
            if (keys['ArrowLeft'] || keys['KeyA']) {
                player.velX = -player.speed;
                player.facingRight = false;
            } else if (keys['ArrowRight'] || keys['KeyD']) {
                player.velX = player.speed;
                player.facingRight = true;
            } else {
                player.velX *= friction;
            }

            if ((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && player.onGround) {
                player.velY = -player.jumpPower;
                player.onGround = false;
            }

            player.velY += gravity;
            player.x += player.velX;
            player.y += player.velY;

            // Platform collision
            player.onGround = false;
            for (const p of currentLevelData.platforms) {
                if (checkCollision(player, p)) {
                    if (player.velY > 0 && player.y + player.height - player.velY <= p.y + 4) {
                        player.y = p.y - player.height;
                        player.velY = 0;
                        player.onGround = true;
                    } else if (player.velY < 0 && player.y - player.velY >= p.y + p.height - 4) {
                        player.y = p.y + p.height;
                        player.velY = 0;
                    } else {
                        if (player.velX > 0) player.x = p.x - player.width;
                        else if (player.velX < 0) player.x = p.x + p.width;
                    }
                }
            }

            // Files
            for (const file of currentLevelData.files) {
                if (collectedFiles.includes(file)) continue;
                if (checkCollision(player, { x: file.x, y: file.y, width: 22, height: 22 })) {
                    collectFile(file);
                    return;
                }
            }

            // Checkpoints
            for (const cp of currentLevelData.checkpoints) {
                if (checkCollision(player, { x: cp.x, y: cp.y, width: 30, height: 32 })) {
                    hitCheckpoint(cp);
                    return;
                }
            }

            // Spikes
            for (const spike of currentLevelData.spikes || []) {
                if (checkCollision(player, spike)) {
                    playerDied();
                    return;
                }
            }

            // Goal
            const g = currentLevelData.goal;
            if (checkCollision(player, { x: g.x, y: g.y, width: 36, height: 36 })) {
                reachGoal();
                return;
            }

            // Bounds
            if (player.x < 0) player.x = 0;
            if (player.x > currentLevelData.width - player.width) {
                player.x = currentLevelData.width - player.width;
            }

            // Fall
            if (player.y > 430) {
                playerDied();
                return;
            }

            // Camera
            const targetX = player.x - canvas.width / 2 + (player.facingRight ? 100 : -100);
            cameraX += (targetX - cameraX) * CAMERA_LERP;
            cameraX = Math.max(0, Math.min(cameraX, currentLevelData.width - canvas.width));
        }

        function draw() {
            // BG
            const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
            grad.addColorStop(0, currentLevelData.bg[0]);
            grad.addColorStop(1, currentLevelData.bg[1]);
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Stars
            ctx.fillStyle = 'rgba(255,255,255,0.35)';
            for (let i = 0; i < 35; i++) {
                const x = ((i * 89 + currentLevel * 23) % (currentLevelData.width * 0.8)) - cameraX * 0.25;
                const y = (i * 43 + currentLevel * 19) % canvas.height;
                if (x > -5 && x < canvas.width + 5) {
                    ctx.beginPath();
                    ctx.arc(x, y, (i % 3) + 0.8, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            ctx.save();
            ctx.translate(-cameraX, 0);

            // Platforms
            ctx.fillStyle = '#4a4a6a';
            ctx.strokeStyle = '#6a6a8a';
            ctx.lineWidth = 2;
            for (const p of currentLevelData.platforms) {
                ctx.fillRect(p.x, p.y, p.width, p.height);
                ctx.strokeRect(p.x, p.y, p.width, p.height);
            }

            // Pits
            for (const pit of currentLevelData.pits || []) {
                ctx.fillStyle = 'rgba(255,50,50,0.12)';
                ctx.fillRect(pit.x, 370, pit.width, 30);
                ctx.fillStyle = '#ff5555';
                ctx.font = 'bold 11px Fira Code';
                ctx.textAlign = 'center';
                ctx.fillText('VOID', pit.x + pit.width/2, 390);
            }

            // Spikes
            ctx.fillStyle = '#ff4757';
            for (const s of currentLevelData.spikes || []) {
                ctx.beginPath();
                for (let i = 0; i < s.width; i += 13) {
                    ctx.moveTo(s.x + i, s.y + s.height);
                    ctx.lineTo(s.x + i + 6.5, s.y);
                    ctx.lineTo(s.x + i + 13, s.y + s.height);
                }
                ctx.fill();
            }

            // Files
            for (const f of currentLevelData.files) {
                if (collectedFiles.includes(f)) continue;
                ctx.fillStyle = f.color;
                ctx.shadowColor = f.color;
                ctx.shadowBlur = 7;
                ctx.fillRect(f.x, f.y, 18, 22);
                ctx.fillStyle = 'rgba(255,255,255,0.25)';
                ctx.fillRect(f.x + 11, f.y, 7, 7);
                ctx.shadowBlur = 0;
            }

            // Checkpoints
            for (const cp of currentLevelData.checkpoints) {
                const active = activeCheckpoints.includes(cp);
                ctx.fillStyle = '#666';
                ctx.fillRect(cp.x + 12, cp.y, 4, 32);
                ctx.fillStyle = active ? '#27ca40' : '#a855f7';
                ctx.shadowColor = active ? '#27ca40' : '#a855f7';
                ctx.shadowBlur = active ? 12 : 4;
                ctx.beginPath();
                ctx.moveTo(cp.x + 16, cp.y);
                ctx.lineTo(cp.x + 36, cp.y + 10);
                ctx.lineTo(cp.x + 16, cp.y + 20);
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            // Goal
            const goal = currentLevelData.goal;
            ctx.fillStyle = '#27ca40';
            ctx.shadowColor = '#27ca40';
            ctx.shadowBlur = 16;
            ctx.beginPath();
            const cx = goal.x + 18, cy = goal.y + 18;
            for (let i = 0; i < 10; i++) {
                const angle = (i * Math.PI / 5) - Math.PI / 2;
                const r = i % 2 === 0 ? 16 : 7;
                const x = cx + Math.cos(angle) * r;
                const y = cy + Math.sin(angle) * r;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.fill();
            ctx.shadowBlur = 0;

            // Player
            ctx.fillStyle = '#00d9ff';
            ctx.shadowColor = '#00d9ff';
            ctx.shadowBlur = 6;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            ctx.shadowBlur = 0;
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(player.x + 4, player.y + 4, 18, 9);
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.fillRect(player.x + 6, player.y + 6, 4, 4);

            ctx.restore();

            // Progress bar
            const prog = player.x / currentLevelData.width;
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(canvas.width/2 - 80, canvas.height - 14, 160, 6);
            ctx.fillStyle = '#a855f7';
            ctx.fillRect(canvas.width/2 - 80, canvas.height - 14, 160 * prog, 6);
            const goalProg = currentLevelData.goal.x / currentLevelData.width;
            ctx.fillStyle = '#27ca40';
            ctx.fillRect(canvas.width/2 - 80 + 160 * goalProg - 2, canvas.height - 16, 4, 10);
        }

        function gameLoop() {
            if (gameRunning) update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        draw();
    </script>
</body>
</html>
